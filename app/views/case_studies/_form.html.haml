:javascript
  $(function(){
    jQuery.expr[':'].Contains = function(a,i,m){
      return (a.textContent || a.innerText || "").toUpperCase().indexOf(m[3].toUpperCase())>=0;
    };
    $(".char-filter").change(filter).keyup(function(){$(this).change()});
    // // // var pH = $('#publish-btn').parent().height()
    // // // var eH = $('#publish-btn').height()
    // // // $('#publish-btn').css('margin-top', (pH - eH)/2)

    // // eH = $('#save-btn').height()
    // // $('#save-btn').css('margin-top', (pH - eH)/2)

    // pH = $('#auto-saved-text').parent().height()
    // eH = $('#auto-saved-text').height()
    // $('#auto-saved-text').css('margin-top', (pH - eH)/2)

    $(".btn-index-create").click(function(e){
      if ($(this).attr("class").includes("collapsed")) {
        $(this).children().removeClass("glyphicon-chevron-down");
        $(this).children().addClass("glyphicon-chevron-up");
      } else {
        $(this).children().removeClass("glyphicon-chevron-up");
        $(this).children().addClass("glyphicon-chevron-down");
      }
    });
  });

  function filter() {
    var filterText = $(this).val();
    if(filterText) {
      $(".char-checkbox-label:not(:Contains(" + filterText + "))").css('background-color', 'white');
      $(".char-checkbox-label:Contains(" + filterText + ")").css('background-color', '#ffff99');
      $(".char-checkbox-label:not(:Contains(" + filterText + "))").slideUp();
      $(".char-checkbox-label:Contains(" + filterText + ")").slideDown();
    } else {
      $(".char-checkbox-label").slideDown();
      $(".char-checkbox-label").css('background-color', 'white');
    }
  }
:css
  .fill-width{
    width: 100%;
  }

  .text-align-left{
    text-align: left;
  }
  #user-action-ui{
    padding-top: 8px;
  }
    #user-action-ui > * {
        margin-right: 4px;
    }
  .edit-char-group {
    font-size: 1em;
    padding-left: 0px;
    font-style: normal;
    font-family: "Times New Roman", Times, serif;
    font-weight: normal;
  }

= form_for @case_study, :html => {:multipart => true} do |f|
  / ERROR MESSAGES
  - if @case_study.errors.any?
    #error_explanation
      %h2
        = pluralize(@case_study.errors.count, "error")
        prohibited this case_study from being saved:
      %ul
        - @case_study.errors.full_messages.each do |msg|
          %li= msg
  #user-action-ui.row
    - if current_user.admin? || current_user.editor?
      = f.submit "Publish", :id => "publish-btn", |
        :class => "btn btn-primary pull-right"    |
    - if current_user.author?
      = f.submit "Ready for Approval", :id => "publish-btn", |
        :class => "btn btn-success pull-right"    |

    = f.submit "Save as Draft", :id => "save-btn", :class => "btn btn-default pull-right"

    /
      <button type="button" class="btn btn-default pull-right" id="save-btn" name="commit" type="submit">
      <haml_loud> glyphyify(&quot;floppy-disk&quot;) </haml_loud> Save as Draft
      </button>

    - if not @case_study.new_record? and (current_user.admin? || current_user.editor?)
      = link_to 'Destroy', case_study_path(@case_study),                                                |
        data: { :confirm => 'Are you sure?' }, :method => :delete, :class=> "btn btn-danger pull-right" |
    / <span id="auto-saved-text" class="pull-right">Auto-saved as draft 2 minutes ago</span>
  / BODY
  .row
    / LEFT CONTENT
    .col-xs-4
      / PEOPLE
      .row
        %h4 Industry Sector
        = select("case_study", "company_id", Company.all.collect {|p| [ p.name, p.id ] }, {include_blank: 'None'})
        %h4 Tag
        .editCharGroup{:style=>"margin-left:15px"}
          = f.collection_check_boxes(:tag_ids, Tag.all, :id, :name) do |t|
            .row
              = t.label(:class=>"edit-char-group") do
                = t.check_box + " " + t.text

          / - Tag.all.each do |t|
          /   - tag = Tag.where(id: t.id)
          /   = f.collection_check_boxes(:tag_ids, tag, :id, :name) {|b| b.label(class: "char-checkbox-label") {b.check_box(class: "char-checkbox") + "  " + b.text}}        
        %p

      .row

        %h4 Country

      / END PEOPLE
      / TOOLS
      .row
        %h4 Authors

      / END TOOLS
      / TIME
      .row
        %h4 Design Process Covered

      / END TIME
      / TAGS

    .col-xs-8
      / INPUT METHOD NAME
      = f.check_box :hidden
      Hidden Case Study?
      - if @case_study.draft? and current_user != nil and current_user.admin?
        %h3{:style=>"color:red;"} Suggestions
        = f.text_area :suggestions, :class => "form-control markdown", :rows => 50
      .input-group-lg{:style => "margin-top: 10px;margin-bottom: 10px;"}
        %h3 Title
        = f.text_field :name, :class=> "form-control", :placeholder => "Case Study Name"
      .input-group-lg{:style => "margin-top: 10px;margin-bottom: 10px;"}
        %h3 Company
        = select("case_study", "company_id", Company.all.collect {|p| [ p.name, p.id ] }, {include_blank: 'None'}, :class => "form-control")

      .row
      .col-xs-6.col-md-12
      - if @case_study.has_image?
        = image_tag(@case_study.image_url)
      - else
        = image_tag("no-image-available.png", :width => "100%", :height => "385")
      - if Rails.env.production?
        = f.file_field :picture
      - else
        = f.file_field :main_image
      %h3 Problem
      = f.text_area :overview, :class => "form-control markdown", :rows => 12
      %h3 Process
      = f.text_area :process, :class => "form-control markdown", :rows => 50
      %h3 Outcome/Benefits
      = f.text_area :outcome, :class => "form-control markdown", :rows => 50
  
      / FORMS




      / END FORMS
    / END RIGHT CONTENT
  / END BODY
